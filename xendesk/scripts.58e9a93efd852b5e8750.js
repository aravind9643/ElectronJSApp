!function(e){"use strict";function t(){}var n=t.prototype,i=e.EventEmitter;function o(e,t){for(var n=e.length;n--;)if(e[n].listener===t)return n;return-1}function r(e){return function(){return this[e].apply(this,arguments)}}n.getListeners=function(e){var t,n,i=this._getEvents();if(e instanceof RegExp)for(n in t={},i)i.hasOwnProperty(n)&&e.test(n)&&(t[n]=i[n]);else t=i[e]||(i[e]=[]);return t},n.flattenListeners=function(e){var t,n=[];for(t=0;t<e.length;t+=1)n.push(e[t].listener);return n},n.getListenersAsObject=function(e){var t,n=this.getListeners(e);return n instanceof Array&&((t={})[e]=n),t||n},n.addListener=function(e,t){if(!function e(t){return"function"==typeof t||t instanceof RegExp||!(!t||"object"!=typeof t)&&e(t.listener)}(t))throw new TypeError("listener must be a function");var n,i=this.getListenersAsObject(e),r="object"==typeof t;for(n in i)i.hasOwnProperty(n)&&-1===o(i[n],t)&&i[n].push(r?t:{listener:t,once:!1});return this},n.on=r("addListener"),n.addOnceListener=function(e,t){return this.addListener(e,{listener:t,once:!0})},n.once=r("addOnceListener"),n.defineEvent=function(e){return this.getListeners(e),this},n.defineEvents=function(e){for(var t=0;t<e.length;t+=1)this.defineEvent(e[t]);return this},n.removeListener=function(e,t){var n,i,r=this.getListenersAsObject(e);for(i in r)r.hasOwnProperty(i)&&-1!==(n=o(r[i],t))&&r[i].splice(n,1);return this},n.off=r("removeListener"),n.addListeners=function(e,t){return this.manipulateListeners(!1,e,t)},n.removeListeners=function(e,t){return this.manipulateListeners(!0,e,t)},n.manipulateListeners=function(e,t,n){var i,o,r=e?this.removeListener:this.addListener,s=e?this.removeListeners:this.addListeners;if("object"!=typeof t||t instanceof RegExp)for(i=n.length;i--;)r.call(this,t,n[i]);else for(i in t)t.hasOwnProperty(i)&&(o=t[i])&&("function"==typeof o?r.call(this,i,o):s.call(this,i,o));return this},n.removeEvent=function(e){var t,n=typeof e,i=this._getEvents();if("string"===n)delete i[e];else if(e instanceof RegExp)for(t in i)i.hasOwnProperty(t)&&e.test(t)&&delete i[t];else delete this._events;return this},n.removeAllListeners=r("removeEvent"),n.emitEvent=function(e,t){var n,i,o,r,s=this.getListenersAsObject(e);for(r in s)if(s.hasOwnProperty(r))for(n=s[r].slice(0),o=0;o<n.length;o++)!0===(i=n[o]).once&&this.removeListener(e,i.listener),i.listener.apply(this,t||[])===this._getOnceReturnValue()&&this.removeListener(e,i.listener);return this},n.trigger=r("emitEvent"),n.emit=function(e){var t=Array.prototype.slice.call(arguments,1);return this.emitEvent(e,t)},n.setOnceReturnValue=function(e){return this._onceReturnValue=e,this},n._getOnceReturnValue=function(){return!this.hasOwnProperty("_onceReturnValue")||this._onceReturnValue},n._getEvents=function(){return this._events||(this._events={})},t.noConflict=function(){return e.EventEmitter=i,t},"function"==typeof define&&define.amd?define(function(){return t}):"object"==typeof module&&module.exports?module.exports=t:e.EventEmitter=t}("undefined"!=typeof window?window:this||{});var{EventEmitter:EventEmitter}=require("events"),interval=0,reconn_interval=0,pushd_url="https://pushd.ajrgroup.in/subscribe?events=",localhost="0.0.0.0";const domainName=location.origin.includes(localhost)?"xenvoice":location.origin.split(".")[1];var filexmlhttp,eventEmitter=new EventEmitter,reconnect=!0;const retryTime=15e3;var wsarray=[];function Socket(){this.socket=null}Socket.prototype.logs=function(e,t,n){console.log("sender"+e+"*****"+t+"******"+n)},Socket.prototype.send=function(e){var t="object"==typeof e?JSON.stringify(e):e,n=window.socket.readyState;window.socket.CLOSED!=n&&window.socket.CLOSING!=n&&(this.logs(e.event_name,n,t),window.socket.send(t))},Socket.prototype.connect=function(e,t){try{if(wsarray.length>0)for(var n=wsarray.length;n--;)console.log("Status:",wsarray[n].readyState,wsarray[n].url,wsarray[n]),wsarray[n].close(),wsarray.splice(n,1);if(void 0!==window.socket&&window.socket.readyState!==WebSocket.CLOSED)return void console.log("WebSocket is already opened.",window.socket.url);var i=new EventSource(pushd_url+e);i.addEventListener("open",function(e){console.log("pushd connected",e)}),i.addEventListener("error",function(e){console.log("pushd error",e)}),i.addEventListener("message",function(e){if(console.log("pushd message",e),e.data){var t=JSON.parse(e.data).message.default,n="string"==typeof t?JSON.parse(t):t;n.event_name?(console.log(n.event_name,"ON MESSAGE inside socket"),eventEmitter.emit(n.event_name,n)):console.log("missing event_name or invalid event_name :: "+n.event_name)}})}catch(o){console.log("exception in socket connection",o)}},Socket.prototype.startPinging=function(){var e={event_name:"ping"},t=this;interval=setInterval(function(){window.socket&&t.send(e)},2e4)},Socket.prototype.stopPinging=function(){clearInterval(interval)},Socket.prototype.listen=function(e){var t=this;try{eventEmitter.on("incoming_notification",function(n){t.logs("in listen method********* ","incoming_notification",JSON.stringify(n)),e("incoming_notification",n)}),eventEmitter.on("incoming_sms_notification",function(n){t.logs("in listen method********* ","incoming_sms_notification",JSON.stringify(n)),e("incoming_sms_notification",n)}),eventEmitter.on("incoming_fax_notification",function(n){t.logs("in listen method********* ","incoming_fax_notification",JSON.stringify(n)),e("incoming_fax_notification",n)}),eventEmitter.on("outgoing_notification",function(n){t.logs("in listen method********* ","outgoing_notification",JSON.stringify(n)),e("outgoing_notification",n)}),eventEmitter.on("pong",function(n){t.logs("in listen method********* ","pong",JSON.stringify(n)),e("pong",n)}),eventEmitter.on("stop_ring",function(n){console.log(n,"inside socket stop ring method"),t.logs("in listen method********* ","stop_ring",JSON.stringify(n)),e("stop_ring",n)})}catch(n){console.error("[WebRtcLib:listen] excep ",n)}},Socket.prototype.disconnect=function(){window.socket&&window.socket.close(4e3,JSON.stringify({status:"logout"}))},Socket.prototype.reconnect=function(e){var t=this;reconnect&&this.connect(function(e){reconnect=!1,t.startPinging(),clearInterval(reconn_interval)})},Socket.prototype.accepted=function(e,t){this.send({event_name:"answer",userid:e,notification_id:t})},Socket.prototype.rejected=function(e,t){this.send({event_name:"reject",userid:e,notification_id:t})},Socket.prototype.stopRing=function(e){this.send({event_name:"stop_ring",notification_id:e}),console.log("Stop Ring sent to socket")};